<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sui structures - Walrus</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Walrus</a></li><li class="chapter-item expanded affix "><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Overview</li><li class="chapter-item expanded "><a href="objectives_use_cases.html"><strong aria-hidden="true">1.</strong> Objectives and use-cases</a></li><li class="chapter-item expanded "><a href="overview.html"><strong aria-hidden="true">2.</strong> Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="properties.html"><strong aria-hidden="true">2.1.</strong> Properties</a></li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">2.2.</strong> Architecture</a></li><li class="chapter-item expanded "><a href="encoding.html"><strong aria-hidden="true">2.3.</strong> Encoding</a></li></ol></li><li class="chapter-item expanded "><a href="operations.html"><strong aria-hidden="true">3.</strong> Operations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="operations-sui.html"><strong aria-hidden="true">3.1.</strong> Sui operations</a></li><li class="chapter-item expanded "><a href="operations-off-chain.html"><strong aria-hidden="true">3.2.</strong> Off-chain operations</a></li></ol></li><li class="chapter-item expanded "><a href="future.html"><strong aria-hidden="true">4.</strong> Future discussion</a></li><li class="chapter-item expanded affix "><li class="part-title">Usage</li><li class="chapter-item expanded "><a href="dev-guide.html"><strong aria-hidden="true">5.</strong> Developer Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="components.html"><strong aria-hidden="true">5.1.</strong> Components</a></li><li class="chapter-item expanded "><a href="dev-operations.html"><strong aria-hidden="true">5.2.</strong> Operations</a></li><li class="chapter-item expanded "><a href="sui-struct.html" class="active"><strong aria-hidden="true">5.3.</strong> Sui structures</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Setup</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.1.</strong> Prerequisites</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.2.</strong> Installation</div></li><li class="chapter-item expanded "><a href="configuration.html"><strong aria-hidden="true">6.3.</strong> Configuration</a></li></ol></li><li class="chapter-item expanded "><a href="interacting.html"><strong aria-hidden="true">7.</strong> Interacting with Walrus</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="client-cli.html"><strong aria-hidden="true">7.1.</strong> Using the client CLI</a></li><li class="chapter-item expanded "><a href="json-api.html"><strong aria-hidden="true">7.2.</strong> Using the client JSON API</a></li><li class="chapter-item expanded "><a href="web-api.html"><strong aria-hidden="true">7.3.</strong> Using the client HTTP API</a></li></ol></li><li class="chapter-item expanded "><a href="examples.html"><strong aria-hidden="true">8.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="python.html"><strong aria-hidden="true">8.1.</strong> Python</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Walrus sites</li><li class="chapter-item expanded affix "><li class="spacer"></li><li class="chapter-item expanded affix "><a href="glossary.html">Glossary</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Walrus</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="sui-structures"><a class="header" href="#sui-structures">Sui Structures</a></h1>
<p>This section is optional and enables advanced use cases.</p>
<p>You can interact with Walrus purely
through the client CLI, and JSON or HTTP APIs provided, without querying or executing transactions
on Sui directly. However, Walrus uses Sui to manage its metadata and smart contract developers can
read information about the Walrus system, as well as stored blobs, on Sui.</p>
<p>This section provides an overview of how you may use Walrus objects in your Sui smart contracts.</p>
<h2 id="blob-and-storage-objects"><a class="header" href="#blob-and-storage-objects">Blob and Storage Objects</a></h2>
<p>Walrus blobs are represented as Sui objects of type <code>Blob</code>. A blob is first registered, indicating
that the storage nodes should expect slivers from a Blob ID to be stored. Then a blob is certified
indicating that a sufficient number of slivers have been stored to guarantee the blob's
availability. When a blob is certified its <code>certified</code> field contains the epoch in which it was
certified.</p>
<p>A <code>Storage</code> object is always associated with a <code>Blob</code> object, reserving enough space for
a long enough period for the blob's storage. A certified blob is available for the period the
underlying storage resource guarantees storage.</p>
<p>Concretely, <code>Blob</code> and <code>Storage</code> objects have the following fields, that can be read through the
Sui SDKs:</p>
<pre><code class="language-move">/// The blob structure represents a blob that has been registered to with some
/// storage, and then may eventually be certified as being available in the
/// system.
public struct Blob has key, store {
    id: UID,
    stored_epoch: u64,
    blob_id: u256,
    size: u64,
    erasure_code_type: u8,
    certified: option::Option&lt;u64&gt;, // The epoch first certified,
                                    // or None if not certified.
    storage: Storage,
}

/// Reservation for storage for a given period, which is inclusive start,
/// exclusive end.
public struct Storage has key, store {
    id: UID,
    start_epoch: u64,
    end_epoch: u64,
    storage_size: u64,
}
</code></pre>
<p>All fields of <code>Blob</code> and <code>Storage</code> objects can be read using the expected functions:</p>
<pre><code class="language-move">// Blob functions
public fun stored_epoch(b: &amp;Blob) : u64;
public fun blob_id(b: &amp;Blob) : u256;
public fun size(b: &amp;Blob) : u64;
public fun erasure_code_type(b: &amp;Blob) : u8;
public fun certified(b: &amp;Blob) : &amp;Option&lt;u64&gt;;
public fun storage(b: &amp;Blob) : &amp;Storage;

// Storage functions
public fun start_epoch(self: &amp;Storage) : u64;
public fun end_epoch(self: &amp;Storage) : u64;
public fun storage_size(self: &amp;Storage) : u64;
</code></pre>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<p>When a blob is first registered a <code>BlobRegistered</code> event is emitted that informs storage nodes
that they should expect slivers associated with its Blob ID. Eventually when the blob is
certified a <code>BlobCertified</code> is emitted containing information about the blob ID and the epoch
after which the blob will be deleted. Before that epoch the blob is guaranteed to be available.</p>
<pre><code class="language-move">/// Signals a blob with metadata is registered.
public struct BlobRegistered has copy, drop {
    epoch: u64,
    blob_id: u256,
    size: u64,
    erasure_code_type: u8,
    end_epoch: u64,
}

/// Signals a blob is certified.
public struct BlobCertified has copy, drop {
    epoch: u64,
    blob_id: u256,
    end_epoch: u64,
}
</code></pre>
<p>The <code>InvalidBlobID</code> event is emitted when storage nodes detect an incorrectly encoded blob.
Such a blob is guaranteed to be also detected as invalid when a read is attempted.</p>
<pre><code class="language-move">/// Signals that a BlobID is invalid.
public struct InvalidBlobID has copy, drop {
    epoch: u64, // The epoch in which the blob ID is first registered as invalid
    blob_id: u256,
}
</code></pre>
<h2 id="system-information"><a class="header" href="#system-information">System information</a></h2>
<p>The Walrus system object contains metadata about the available and used storage, as well as the
price of storage per Kib of storage in MIST. The committee
structure within the system object can be used to read the current epoch number, as well as
information about the committee.</p>
<pre><code class="language-move">const BYTES_PER_UNIT_SIZE : u64 = 1_024;

public struct System&lt;phantom WAL&gt; has key, store {

    id: UID,

    /// The current committee, with the current epoch.
    /// The option is always Some, but need it for swap.
    current_committee: Option&lt;Committee&gt;,

    /// When we first enter the current epoch we SYNC,
    /// and then we are DONE after a cert from a quorum.
    epoch_status: u8,

    // Some accounting
    total_capacity_size : u64,
    used_capacity_size : u64,

    /// The price per unit size of storage.
    price_per_unit_size: u64,

    /// Tables about the future and the past.
    past_committees: Table&lt;u64, Committee&gt;,
    future_accounting: FutureAccountingRingBuffer&lt;WAL&gt;,
}

public struct Committee has store {
    epoch: u64,
    bls_committee : BlsCommittee,
}
</code></pre>
<p>A few public functions of the committee allow contracts to read Walrus metadata:</p>
<pre><code class="language-move">/// Get epoch. Uses the committee to get the epoch.
public fun epoch&lt;WAL&gt;(self: &amp;System&lt;WAL&gt;) : u64;

/// Accessor for total capacity size.
public fun total_capacity_size&lt;WAL&gt;(self: &amp;System&lt;WAL&gt;) : u64;

/// Accessor for used capacity size.
public fun used_capacity_size&lt;WAL&gt;(self: &amp;System&lt;WAL&gt;) : u64;

// The number of shards
public fun n_shards&lt;WAL&gt;(self: &amp;System&lt;WAL&gt;) : u16;
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="dev-operations.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="configuration.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="dev-operations.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="configuration.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
